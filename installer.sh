#!/bin/bash
__d__() { echo "Err: $1" >&2; exit 1; }; __l__() { echo "$(date +"%Y-%m-%d %T") - $1"; }; __p__() { echo "System Info:"; echo "-------------------"; echo "Disk Space: $(df -h / | awk 'NR==2 {print $4}')"; echo "Total Memory: $(free -m | awk 'NR==2 {print $2}') MB"; echo "CPU Cores: $(nproc)"; echo "Root: $(if [ $(id -u) -eq 0 ]; then echo "Yes"; else echo "No"; fi)"; echo "-------------------"; }; __c__() { if [ "$(id -u)" != "0" ]; then __d__ "Must be root"; fi; }; __o__() { if ! command -v apt &> /dev/null; then __d__ "Only Debian or BSD"; fi; }; __s__() { r=1000000; a=$(df / | awk 'NR==2 {print $4}'); if [ "$a" -lt "$r" ]; then __d__ "Insufficient space"; fi; }; __n__() { m=$(free -m | awk 'NR==2 {print $2}'); c=$(nproc); if [ "$m" -lt 2048 ] || [ "$c" -lt 2 ]; then __d__ "Insufficient resources"; fi; }; __e__() { f=("/etc/.user" "/etc/.pass" "/etc/.ssh" "/etc/.api" "/etc/.card" "/etc/.lockout" "/etc/.srccode" "/etc/.privnote" "/usr/local/bin/MIRA"); for i in "${f[@]}"; do if [ -e "$i" ]; then rm -rf "$i" || __d__ "Failed to delete $i"; fi; done; }; __i__() { __l__ "Installing dependencies..."; apt update > /dev/null || __d__ "Failed to update"; apt install -y build-essential gcc python3 python3-pip > /dev/null || __d__ "Failed to install"; __l__ "Dependencies installed."; }; __k__() { if ! command -v python3 &> /dev/null || ! command -v pip3 &> /dev/null; then __i__; else __l__ "Dependencies installed."; fi; }; __t__() { __l__ "Installing Python libs..."; for r in "${l[@]}"; do if ! pip3 show "$r" &> /dev/null; then pip3 install "$r" > /dev/null 2>&1 || { __d__ "Failed to install $r"; }; fi; done; }; __m__() { chmod +x MIRA.py || __d__ "Failed to make executable"; }; __h__() { if [ -e "/usr/local/bin/MIRA" ]; then __l__ "Link exists"; else ln -s "$(pwd)/MIRA.py" /usr/local/bin/MIRA || __d__ "Failed to link"; __l__ "Link created."; sed -i '1i#!/usr/bin/env python3' /usr/local/bin/MIRA; fi; }; __f__() { rm -f "$(pwd)/MIRA.py" || __d__ "Failed to delete MIRA.py"; }; __j__() { echo "Interrupted."; exit 1; }; main() { trap __j__ SIGINT; __p__; __c__; __o__; __s__; __n__; __e__; __k__; l=("cryptography" "termcolor" "mnemonic" "argon2-cffi" "prompt-toolkit" "password-strength" "pyotp" "paramiko" "validators" "phonenumbers"); __t__; __m__; __h__; __f__; __l__ "Installation completed! Type 'MIRA' to start."; cd .. || __d__ "Failed to change directory"; rm -rf MIRA || __d__ "Failed to delete MIRA";}; main
